# CLAMP <img src="man/figures/plier2.png" width="121px" height="140px" align="right" style="padding-left:10px;background-color:white;" />

# PLIER2

**PLIER2 (Pathway-Level Information ExtractoR 2)** is a scalable framework for extracting biologically meaningful latent variables from gene expression data using prior knowledge of gene sets. It builds upon and extends the original [PLIER](https://github.com/wgmao/PLIER) method, offering improvements in performance and reproducibility for large-scale datasets like GTEx and ARCHS4.

## ðŸ”§ Installation

Set up the Conda environment using the provided environment file:

```bash
conda env create -f envs/plier2.yaml
conda activate plier2
```

## ðŸ“˜ Vignettes

This repository provides three RMarkdown vignettes to demonstrate the usage of PLIER and PLIER2:

1. **`vignettes/gtex.Rmd`**  
   Automatically downloads and processes the GTEx dataset, then builds models using both PLIER and PLIER2.

2. **`vignettes/gtex_comparisons.Rmd`**  
   Compares the results of PLIER and PLIER2 on the GTEx data generated by `vignettes/gtex.Rmd`.

3. **`vignettes/archs4.Rmd`**  
   *(Under construction)* Automatically downloads ARCHS4 data and fits a model using PLIER2.

To render any of these RMarkdown files from the command line:

```bash
Rscript -e "rmarkdown::render('vignettes/gtex.Rmd')"
Rscript -e "rmarkdown::render('vignettes/gtex_comparisons.Rmd')"
```

### ARCHS4

If you want to control paralellization of OpenBLAS, run this before Rscript:

```bash
n_jobs=30
export NUMBA_NUM_THREADS=$n_jobs
export MKL_NUM_THREADS=$n_jobs
export OPENBLAS_NUM_THREADS=$n_jobs
export NUMEXPR_NUM_THREADS=$n_jobs
export OMP_NUM_THREADS=$n_jobs
```

```bash
Rscript -e "rmarkdown::render('vignettes/archs4-01-data_download.Rmd')"
Rscript -e "rmarkdown::render('vignettes/archs4-02-data_preprocess.Rmd')"
Rscript -e "rmarkdown::render('vignettes/archs4-03-data_filtering.Rmd')"
Rscript -e "rmarkdown::render('vignettes/archs4-04-svd.Rmd')"
Rscript -e "rmarkdown::render('vignettes/archs4-05-simple_decomp.Rmd')"
Rscript -e "rmarkdown::render('vignettes/archs4-06-PLIERv2.Rmd')"
```

## ðŸ“‚ Input Data

Each RMarkdown handles downloading and preprocessing of input data as needed. Data types include:

- **Gene expression matrix**: Gene Ã— Sample matrix (e.g., TPM or counts normalized and log-transformed)
- **Pathway matrix**: Gene Ã— Pathway binary matrix

## ðŸ“¤ Output

Model objects created by PLIER2 contain:

- `Z`: Gene loadings matrix (`Genes Ã— Latent Variables`)
- `B`: Latent variable activity matrix (`Latent Variables Ã— Samples`)
- `U`: Prior information coefficients (`Pathways Ã— Latent Variables`)
- `summary`: Metadata describing each latent variable (e.g., pathway enrichment, variance explained)

## ðŸ’¡ Citation

If you use this software in your research, please cite:

> Subirana-GranÃ©s, M., Chikina, M., Pividori, M. *A scalable pathway-level information extractor for massive gene expression datasets*. (In preparation)

## ðŸ“« Contact

For questions or issues, please open a GitHub [issue](https://github.com/your-username/PLIER2/issues).
